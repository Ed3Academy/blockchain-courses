# 📊完善拍卖出价方法

## **🚧 教学目标**

1. 了解和掌握solidity引用类型
2. 了解和掌握映射类型
3. 了解和掌握条件判断
4. 了解和掌握异常处理

## **💚 任务描述**

在盲拍系统中，允许多个用户参与竞拍，当然一个用户也可以多次参与竞拍，而竞拍系统要判断和记录最高竞拍者信息，需要针对以下情况进行处理：
    
1. 当本次竞拍价低于最高竞拍记录，触发异常回滚交易，将钱退回   
2. 当本次竞拍价高于最高竞拍记录，需保存被替代的最高竞拍记录（映射被替代的最高竞拍记录者的账户以及对应竞拍价），以备竞拍结束将钱款退回
3. 一个用户可以参与多次竞拍，他可能被重复替代，因此每次待退回的钱款要进行累加。  
4. 替代本次竞拍者为最高竞拍记录者  
通过以上处理，进一步完善任务1.  

## **⚡ 相关知识**
知识点简述，（后续会替换AI课件，可以先参看AI脚本：）  
[AI课件](https://docs.qq.com/sheet/DSmdHWWNoT25LTENl?tab=e6n1tf)  
   

## **✨ 任务关键步骤分析**

1. 声明一个错误异常，接收异常参数当前竞拍价，本次竞拍价作为错误信息反馈
2. 声明一个映射变量，用于映射被替代的最高竞拍记录者的账户=>竞拍价
3. 执行判断逻辑，当本次竞拍低于或者等于最高竞拍记录，抛出错误异常，传递匹配参数
4. 当本次竞拍高于当前最高竞拍记录，保存替代者的最高竞拍记录，映射账户和对应的竞拍价，注意可能多次被替代，要进行账户钱款的累加

## **✨ 任务实现**
1. **完善合约**  
    根据步骤提示，完善右侧合约文件中begin...end之间的代码。
3. **合约测试**  
   a. 编译合约：点击编译按钮

   ![compile_contract.png](https://ed3academy.xyz/github/courses/Bid_Master/compile_contract.png)

   b. 部署合约：选择部署选项卡，确认合约是否为待部署的合约，点击Deploy按钮，发布合约

   ![deploy.png](https://ed3academy.xyz/github/courses/Bid_Master/deploy.png)

   c. 选择测试账户：下拉列表为Remix提供的区块链上虚拟用户，选择一个区块链账户

   ![test_account.png](https://ed3academy.xyz/github/courses/Bid_Master/test_account.png)

   d. 设置竞拍价格、测试竞拍方法、查看相应的状态变量

   ![call_function.png](https://ed3academy.xyz/github/courses/Bid_Master/call_function.png)

其中，address显示的是最高竞拍者的地址，通过Remix完成合约的部署和合约方法的测试。

## **🌸 知识测试**  